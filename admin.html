<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Brangkas Data Guru Multi Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-transition { transition: transform 0.3s ease; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .modal-backdrop { backdrop-filter: blur(5px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .notification { transition: all 0.3s ease; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600 sticky top-0 z-40">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <button id="sidebarToggle" class="md:hidden text-gray-600 hover:text-blue-600 transition-colors">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="gradient-bg w-12 h-12 rounded-full flex items-center justify-center">
                        <i class="fas fa-school text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Admin Panel Multi-Sekolah</h1>
                        <p class="text-sm text-gray-600">Kelola semua sekolah dalam satu dashboard</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-2 bg-gray-100 px-3 py-2 rounded-lg">
                    <i class="fas fa-clock text-gray-500"></i>
                    <span id="currentTime" class="text-sm text-gray-700"></span>
                </div>
                
                <div class="flex items-center space-x-2">
                    <div id="connectionStatus" class="w-3 h-3 rounded-full bg-gray-400 animate-pulse" title="Status koneksi"></div>
                    <button onclick="syncData()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                        <i class="fas fa-sync-alt mr-1"></i>Sync
                    </button>
                </div>
                
                <div class="relative">
                    <button onclick="showUserMenu()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-user mr-2"></i>Admin
                    </button>
                    <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-50">
                        <a href="#" onclick="showProfile()" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-user-circle mr-2"></i>Profil
                        </a>
                        <a href="#" onclick="showSettings()" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-cog mr-2"></i>Pengaturan
                        </a>
                        <hr class="my-1">
                        <a href="#" onclick="logout()" class="block px-4 py-2 text-red-600 hover:bg-red-50">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar fixed md:relative bg-white w-64 h-screen shadow-lg z-30 sidebar-transition">
            <div class="p-6">
                <nav class="space-y-2">
                    <a href="#" onclick="showSection('dashboard')" class="nav-link active flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-tachometer-alt w-5"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" onclick="showSection('schools')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-school w-5"></i>
                        <span>Kelola Sekolah</span>
                    </a>
                    <a href="#" onclick="showSection('users')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-users w-5"></i>
                        <span>Kelola User</span>
                    </a>
                    <a href="#" onclick="showSection('templates')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-palette w-5"></i>
                        <span>Template</span>
                    </a>
                    <a href="#" onclick="showSection('reports')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-chart-bar w-5"></i>
                        <span>Laporan</span>
                    </a>
                    <a href="#" onclick="showSection('backup')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-database w-5"></i>
                        <span>Backup</span>
                    </a>
                    <a href="#" onclick="showSection('settings')" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-cog w-5"></i>
                        <span>Pengaturan</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:ml-0">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h2>
                    <p class="text-gray-600">Ringkasan sistem multi-sekolah Anda</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="gradient-bg text-white p-6 rounded-xl card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Total Sekolah</p>
                                <p id="totalSchools" class="text-3xl font-bold">0</p>
                            </div>
                            <i class="fas fa-school text-4xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Sekolah Aktif</p>
                                <p id="activeSchools" class="text-3xl font-bold">0</p>
                            </div>
                            <i class="fas fa-check-circle text-4xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white p-6 rounded-xl card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Total User</p>
                                <p id="totalUsers" class="text-3xl font-bold">0</p>
                            </div>
                            <i class="fas fa-users text-4xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-xl card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Backup Terakhir</p>
                                <p id="lastBackup" class="text-lg font-bold">Belum ada</p>
                            </div>
                            <i class="fas fa-save text-4xl opacity-80"></i>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="addNewSchool()" class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition-colors text-center card-hover">
                            <i class="fas fa-plus text-2xl mb-2"></i>
                            <p class="font-semibold">Tambah Sekolah</p>
                        </button>
                        <button onclick="addNewUser()" class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors text-center card-hover">
                            <i class="fas fa-user-plus text-2xl mb-2"></i>
                            <p class="font-semibold">Tambah User</p>
                        </button>
                        <button onclick="exportData()" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition-colors text-center card-hover">
                            <i class="fas fa-download text-2xl mb-2"></i>
                            <p class="font-semibold">Export Data</p>
                        </button>
                        <button onclick="createBackup()" class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 transition-colors text-center card-hover">
                            <i class="fas fa-database text-2xl mb-2"></i>
                            <p class="font-semibold">Backup</p>
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Aktivitas Terbaru</h3>
                    <div id="recentActivity" class="space-y-3">
                        <!-- Activity items will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Schools Management Section -->
            <section id="schools-section" class="section hidden">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Kelola Sekolah</h2>
                        <p class="text-gray-600">Tambah, edit, dan kelola semua sekolah</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="addNewSchool()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Sekolah
                        </button>
                        <button onclick="importSchools()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-upload mr-2"></i>Import
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                        <div class="flex-1 max-w-md">
                            <div class="relative">
                                <input type="text" id="searchSchools" placeholder="Cari sekolah..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Semua Status</option>
                                <option value="active">Aktif</option>
                                <option value="inactive">Tidak Aktif</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                            <button onclick="refreshSchoolsList()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Schools List -->
                <div id="schoolsList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- School cards will be populated here -->
                </div>
            </section>

            <!-- Users Management Section -->
            <section id="users-section" class="section hidden">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Kelola User</h2>
                        <p class="text-gray-600">Manajemen user dan hak akses</p>
                    </div>
                    <button onclick="addNewUser()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>Tambah User
                    </button>
                </div>

                <!-- Users List -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sekolah</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="usersList" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Templates Section -->
            <section id="templates-section" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Template Sekolah</h2>
                    <p class="text-gray-600">Kelola template dan tema untuk sekolah</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Template cards will be populated here -->
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports-section" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Laporan</h2>
                    <p class="text-gray-600">Statistik dan analisis sistem</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Charts and reports will be populated here -->
                </div>
            </section>

            <!-- Backup Section -->
            <section id="backup-section" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Backup & Restore</h2>
                    <p class="text-gray-600">Kelola backup data sistem</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Create Backup -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Buat Backup</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Jenis Backup</label>
                                <select id="backupType" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="full">Full Backup (Semua Data)</option>
                                    <option value="schools">Data Sekolah</option>
                                    <option value="users">Data User</option>
                                    <option value="settings">Pengaturan</option>
                                </select>
                            </div>
                            <button onclick="createBackup()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-save mr-2"></i>Buat Backup
                            </button>
                        </div>
                    </div>

                    <!-- Restore Backup -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Restore Backup</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Upload File Backup</label>
                                <input type="file" id="restoreFile" accept=".json" class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                    <span class="text-sm text-yellow-800">
                                        <strong>Peringatan:</strong> Restore akan menimpa data yang ada!
                                    </span>
                                </div>
                            </div>
                            <button onclick="restoreBackup()" class="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition-colors">
                                <i class="fas fa-upload mr-2"></i>Restore Backup
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Backup History -->
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4">Riwayat Backup</h3>
                    <div id="backupHistory" class="space-y-3">
                        <!-- Backup history will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Pengaturan</h2>
                    <p class="text-gray-600">Konfigurasi sistem dan preferensi</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- General Settings -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Pengaturan Umum</h3>
                        <form id="generalSettings" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Nama Sistem</label>
                                <input type="text" id="systemName" value="Brangkas Data Guru" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Domain Utama</label>
                                <input type="text" id="mainDomain" value="yourdomain.com" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Email Admin</label>
                                <input type="email" id="adminEmail" value="admin@yourdomain.com" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Simpan Pengaturan
                            </button>
                        </form>
                    </div>

                    <!-- Security Settings -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">Pengaturan Keamanan</h3>
                        <form id="securitySettings" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Session Timeout (menit)</label>
                                <input type="number" id="sessionTimeout" value="30" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Max Login Attempts</label>
                                <input type="number" id="maxLoginAttempts" value="5" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="enableTwoFactor" class="mr-2">
                                <label for="enableTwoFactor" class="text-gray-700">Enable Two-Factor Authentication</label>
                            </div>
                            <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors">
                                Simpan Keamanan
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Global Variables
        let schoolsData = {};
        let usersData = {};
        let templatesData = {};
        let activityLog = [];
        let backupHistory = [];
        let currentUser = { username: 'admin', role: 'super_admin' };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadSampleData();
            updateStats();
            loadSchoolsList();
            loadUsersList();
            loadRecentActivity();
            loadBackupHistory();
            
            // Start clock
            updateClock();
            setInterval(updateClock, 1000);
            
            // Setup event listeners
            setupEventListeners();
            
            // Show welcome notification
            showNotification('Selamat datang di Admin Panel!', 'success');
            
            // Simulate connection status
            updateConnectionStatus(true);
        }

        function loadSampleData() {
            // Sample schools data
            schoolsData = {
                'sdn1': {
                    name: 'SD Negeri 1 Jakarta',
                    colors: { primary: '#3b82f6', secondary: '#10b981' },
                    contact: { phone: '021-12345678', email: 'admin@sdn1.sch.id' },
                    status: 'active',
                    created_at: '2024-01-01T00:00:00Z',
                    users_count: 15
                },
                'sdn2': {
                    name: 'SD Negeri 2 Jakarta',
                    colors: { primary: '#ef4444', secondary: '#f59e0b' },
                    contact: { phone: '021-87654321', email: 'admin@sdn2.sch.id' },
                    status: 'active',
                    created_at: '2024-01-02T00:00:00Z',
                    users_count: 12
                },
                'smp1': {
                    name: 'SMP Negeri 1 Jakarta',
                    colors: { primary: '#8b5cf6', secondary: '#06b6d4' },
                    contact: { phone: '021-11223344', email: 'admin@smp1.sch.id' },
                    status: 'maintenance',
                    created_at: '2024-01-03T00:00:00Z',
                    users_count: 25
                }
            };

            // Sample users data
            usersData = {
                'admin': {
                    username: 'admin',
                    email: 'admin@system.com',
                    role: 'super_admin',
                    school: 'all',
                    status: 'active',
                    last_login: '2024-01-15T10:30:00Z'
                },
                'guru1': {
                    username: 'guru1',
                    email: 'guru1@sdn1.sch.id',
                    role: 'teacher',
                    school: 'sdn1',
                    status: 'active',
                    last_login: '2024-01-15T09:15:00Z'
                },
                'admin_sdn2': {
                    username: 'admin_sdn2',
                    email: 'admin@sdn2.sch.id',
                    role: 'school_admin',
                    school: 'sdn2',
                    status: 'active',
                    last_login: '2024-01-15T08:45:00Z'
                }
            };

            // Sample activity log
            activityLog = [
                { action: 'Login sistem', user: 'admin', timestamp: new Date().toISOString() },
                { action: 'Menambah sekolah baru: SMP Negeri 1', user: 'admin', timestamp: new Date(Date.now() - 3600000).toISOString() },
                { action: 'Update profil user guru1', user: 'admin', timestamp: new Date(Date.now() - 7200000).toISOString() },
                { action: 'Backup data sistem', user: 'admin', timestamp: new Date(Date.now() - 86400000).toISOString() }
            ];

            // Sample backup history
            backupHistory = [
                {
                    id: Date.now(),
                    name: 'backup-full-2024-01-15',
                    type: 'full',
                    timestamp: new Date().toISOString(),
                    size: 2048576
                }
            ];
        }

        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
            
            // Search functionality
            const searchInput = document.getElementById('searchSchools');
            if (searchInput) {
                searchInput.addEventListener('input', filterSchools);
            }
            
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', filterSchools);
            }
            
            // Form submissions
            const generalForm = document.getElementById('generalSettings');
            if (generalForm) {
                generalForm.addEventListener('submit', saveGeneralSettings);
            }
            
            const securityForm = document.getElementById('securitySettings');
            if (securityForm) {
                securityForm.addEventListener('submit', saveSecuritySettings);
            }
            
            // Close user menu when clicking outside
            document.addEventListener('click', function(e) {
                const userMenu = document.getElementById('userMenu');
                if (userMenu && !e.target.closest('.relative')) {
                    userMenu.classList.add('hidden');
                }
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.add('hidden');
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active', 'bg-blue-50', 'text-blue-600');
            });
            
            event.target.classList.add('active', 'bg-blue-50', 'text-blue-600');
            
            // Close sidebar on mobile
            if (window.innerWidth < 768) {
                closeSidebar();
            }
            
            // Load section-specific data
            switch(sectionName) {
                case 'schools':
                    loadSchoolsList();
                    break;
                case 'users':
                    loadUsersList();
                    break;
                case 'templates':
                    loadTemplatesList();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'backup':
                    loadBackupHistory();
                    break;
            }
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const clockElement = document.getElementById('currentTime');
            if (clockElement) {
                clockElement.textContent = timeString;
            }
        }

        function updateStats() {
            const total = Object.keys(schoolsData).length;
            const active = Object.values(schoolsData).filter(school => school.status === 'active').length;
            const totalUsersCount = Object.keys(usersData).length;
            
            document.getElementById('totalSchools').textContent = total;
            document.getElementById('activeSchools').textContent = active;
            document.getElementById('totalUsers').textContent = totalUsersCount;
            
            // Update last backup
            if (backupHistory.length > 0) {
                const lastBackup = new Date(backupHistory[backupHistory.length - 1].timestamp);
                document.getElementById('lastBackup').textContent = lastBackup.toLocaleDateString('id-ID');
            }
        }

        function loadSchoolsList() {
            const container = document.getElementById('schoolsList');
            if (!container) return;
            
            container.innerHTML = '';

            Object.keys(schoolsData).forEach(schoolId => {
                const school = schoolsData[schoolId];
                const schoolCard = createSchoolCard(schoolId, school);
                container.appendChild(schoolCard);
            });
        }

        function createSchoolCard(schoolId, school) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-lg p-6 border-l-4 card-hover';
            card.style.borderLeftColor = school.colors.primary;
            
            const statusColor = school.status === 'active' ? 'green' : school.status === 'maintenance' ? 'yellow' : 'red';
            const statusText = school.status === 'active' ? 'Aktif' : school.status === 'maintenance' ? 'Maintenance' : 'Tidak Aktif';
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg" 
                             style="background: ${school.colors.primary}">
                            ${schoolId.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <h4 class="font-bold text-lg text-gray-800">${school.name}</h4>
                            <p class="text-sm text-gray-600">${schoolId}.yourdomain.com</p>
                            <span class="inline-block px-2 py-1 text-xs rounded-full bg-${statusColor}-100 text-${statusColor}-800 mt-1">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editSchool('${schoolId}')" class="bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                        <button onclick="deleteSchool('${schoolId}')" class="bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash mr-1"></i>Hapus
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                    <div>
                        <span class="text-gray-500">Warna Utama:</span>
                        <div class="flex items-center mt-1">
                            <div class="w-4 h-4 rounded mr-2" style="background: ${school.colors.primary}"></div>
                            <span class="font-mono text-xs">${school.colors.primary}</span>
                        </div>
                    </div>
                    <div>
                        <span class="text-gray-500">Total User:</span>
                        <div class="mt-1 font-semibold">${school.users_count || 0} user</div>
                    </div>
                    <div>
                        <span class="text-gray-500">Telepon:</span>
                        <div class="mt-1">${school.contact.phone || '-'}</div>
                    </div>
                    <div>
                        <span class="text-gray-500">Email:</span>
                        <div class="mt-1 text-xs">${school.contact.email || '-'}</div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                    <div class="text-xs text-gray-500">
                        Dibuat: ${new Date(school.created_at).toLocaleDateString('id-ID')}
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="previewSchool('${schoolId}')" class="text-blue-600 hover:text-blue-800 text-sm transition-colors">
                            <i class="fas fa-eye mr-1"></i>Preview
                        </button>
                        <button onclick="exportSchool('${schoolId}')" class="text-green-600 hover:text-green-800 text-sm transition-colors">
                            <i class="fas fa-download mr-1"></i>Export
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function loadUsersList() {
            const container = document.getElementById('usersList');
            if (!container) return;
            
            container.innerHTML = '';

            Object.keys(usersData).forEach(userId => {
                const user = usersData[userId];
                const userRow = createUserRow(userId, user);
                container.appendChild(userRow);
            });
        }

        function createUserRow(userId, user) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            
            const roleText = user.role === 'super_admin' ? 'Super Admin' : 
                           user.role === 'school_admin' ? 'Admin Sekolah' : 'Guru';
            const schoolText = user.school === 'all' ? 'Semua Sekolah' : 
                              schoolsData[user.school]?.name || user.school;
            const statusColor = user.status === 'active' ? 'green' : 'red';
            const statusText = user.status === 'active' ? 'Aktif' : 'Tidak Aktif';
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-gray-600"></i>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${user.username}</div>
                            <div class="text-sm text-gray-500">${user.email}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        ${roleText}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    ${schoolText}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${statusColor}-100 text-${statusColor}-800">
                        ${statusText}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="editUser('${userId}')" class="text-blue-600 hover:text-blue-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteUser('${userId}')" class="text-red-600 hover:text-red-900 transition-colors">Hapus</button>
                </td>
            `;
            
            return row;
        }

        function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (activityLog.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <i class="fas fa-history text-2xl mb-2"></i>
                        <p>Belum ada aktivitas</p>
                    </div>
                `;
                return;
            }
            
            activityLog.slice(-5).reverse().forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                activityItem.innerHTML = `
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-clock text-blue-600 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium">${activity.action}</div>
                        <div class="text-xs text-gray-500">
                            ${activity.user} • ${new Date(activity.timestamp).toLocaleString('id-ID')}
                        </div>
                    </div>
                `;
                container.appendChild(activityItem);
            });
        }

        function loadBackupHistory() {
            const container = document.getElementById('backupHistory');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (backupHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-database text-4xl mb-4"></i>
                        <p>Belum ada backup yang dibuat</p>
                    </div>
                `;
                return;
            }
            
            backupHistory.slice(-10).reverse().forEach(backup => {
                const backupItem = document.createElement('div');
                backupItem.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                backupItem.innerHTML = `
                    <div>
                        <div class="font-semibold">${backup.name}</div>
                        <div class="text-sm text-gray-600">
                            ${backup.type.toUpperCase()} • ${new Date(backup.timestamp).toLocaleString('id-ID')} • ${(backup.size / 1024).toFixed(1)} KB
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="downloadBackup('${backup.id}')" class="text-blue-600 hover:text-blue-800 text-sm transition-colors">
                            <i class="fas fa-download mr-1"></i>Download
                        </button>
                        <button onclick="deleteBackup('${backup.id}')" class="text-red-600 hover:text-red-800 text-sm transition-colors">
                            <i class="fas fa-trash mr-1"></i>Hapus
                        </button>
                    </div>
                `;
                container.appendChild(backupItem);
            });
        }

        // School Management Functions
        function addNewSchool() {
            showModal('Tambah Sekolah Baru', `
                <form id="addSchoolForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">ID Sekolah</label>
                        <input type="text" id="newSchoolId" placeholder="contoh: sdn4" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        <p class="text-sm text-gray-500 mt-1">Akan jadi: [id].yourdomain.com</p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Nama Sekolah</label>
                        <input type="text" id="newName" placeholder="SD Negeri 4 Jakarta" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Warna Utama</label>
                            <input type="color" id="newPrimary" value="#3b82f6" class="w-full h-10 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Warna Sekunder</label>
                            <input type="color" id="newSecondary" value="#10b981" class="w-full h-10 border rounded-lg">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Telepon</label>
                        <input type="tel" id="newPhone" placeholder="021-12345678" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Email</label>
                        <input type="email" id="newEmail" placeholder="admin@sekolah.sch.id" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Status</label>
                        <select id="newStatus" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="active">Aktif</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="inactive">Tidak Aktif</option>
                        </select>
                    </div>
                </form>
            `, [
                {
                    text: 'Tambah Sekolah',
                    class: 'bg-green-600 hover:bg-green-700',
                    onclick: () => {
                        const form = document.getElementById('addSchoolForm');
                        if (form.checkValidity()) {
                            const schoolId = document.getElementById('newSchoolId').value.toLowerCase();
                            
                            if (schoolsData[schoolId]) {
                                showNotification('ID sekolah sudah ada! Gunakan ID yang berbeda.', 'error');
                                return;
                            }
                            
                            schoolsData[schoolId] = {
                                name: document.getElementById('newName').value,
                                colors: {
                                    primary: document.getElementById('newPrimary').value,
                                    secondary: document.getElementById('newSecondary').value
                                },
                                contact: {
                                    phone: document.getElementById('newPhone').value,
                                    email: document.getElementById('newEmail').value
                                },
                                status: document.getElementById('newStatus').value,
                                created_at: new Date().toISOString(),
                                users_count: 0
                            };
                            
                            loadSchoolsList();
                            updateStats();
                            closeModal();
                            logActivity(`Menambah sekolah baru: ${schoolsData[schoolId].name}`);
                            showNotification(`Sekolah ${schoolId} berhasil ditambahkan!`, 'success');
                        }
                    }
                },
                {
                    text: 'Batal',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function editSchool(schoolId) {
            const school = schoolsData[schoolId];
            showModal(`Edit Sekolah: ${schoolId}`, `
                <form id="editSchoolForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Nama Sekolah</label>
                        <input type="text" id="editName" value="${school.name}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Warna Utama</label>
                            <input type="color" id="editPrimary" value="${school.colors.primary}" class="w-full h-10 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Warna Sekunder</label>
                            <input type="color" id="editSecondary" value="${school.colors.secondary}" class="w-full h-10 border rounded-lg">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Telepon</label>
                        <input type="tel" id="editPhone" value="${school.contact.phone || ''}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Email</label>
                        <input type="email" id="editEmail" value="${school.contact.email || ''}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Status</label>
                        <select id="editStatus" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="active" ${school.status === 'active' ? 'selected' : ''}>Aktif</option>
                            <option value="maintenance" ${school.status === 'maintenance' ? 'selected' : ''}>Maintenance</option>
                            <option value="inactive" ${school.status === 'inactive' ? 'selected' : ''}>Tidak Aktif</option>
                        </select>
                    </div>
                </form>
            `, [
                {
                    text: 'Simpan Perubahan',
                    class: 'bg-blue-600 hover:bg-blue-700',
                    onclick: () => {
                        schoolsData[schoolId] = {
                            ...school,
                            name: document.getElementById('editName').value,
                            colors: {
                                primary: document.getElementById('editPrimary').value,
                                secondary: document.getElementById('editSecondary').value
                            },
                            contact: {
                                phone: document.getElementById('editPhone').value,
                                email: document.getElementById('editEmail').value
                            },
                            status: document.getElementById('editStatus').value
                        };
                        
                        loadSchoolsList();
                        updateStats();
                        closeModal();
                        logActivity(`Mengedit sekolah: ${schoolsData[schoolId].name}`);
                        showNotification(`Sekolah ${schoolId} berhasil diupdate!`, 'success');
                    }
                },
                {
                    text: 'Batal',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function deleteSchool(schoolId) {
            if (confirm(`Yakin ingin menghapus sekolah "${schoolId}"?\n\nTindakan ini tidak dapat dibatalkan!`)) {
                const schoolName = schoolsData[schoolId].name;
                delete schoolsData[schoolId];
                
                loadSchoolsList();
                updateStats();
                logActivity(`Menghapus sekolah: ${schoolName}`);
                showNotification(`Sekolah ${schoolId} berhasil dihapus!`, 'success');
            }
        }

        function previewSchool(schoolId) {
            const school = schoolsData[schoolId];
            const previewUrl = `https://${schoolId}.yourdomain.com`;
            
            showModal(`Preview: ${school.name}`, `
                <div class="text-center space-y-4">
                    <div class="w-20 h-20 rounded-full mx-auto flex items-center justify-center text-white text-2xl font-bold" 
                         style="background: ${school.colors.primary}">
                        ${schoolId.charAt(0).toUpperCase()}
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-bold">${school.name}</h3>
                        <p class="text-gray-600">${previewUrl}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <div class="font-semibold">Warna Utama</div>
                            <div class="flex items-center mt-1">
                                <div class="w-4 h-4 rounded mr-2" style="background: ${school.colors.primary}"></div>
                                <span class="font-mono">${school.colors.primary}</span>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <div class="font-semibold">Warna Sekunder</div>
                            <div class="flex items-center mt-1">
                                <div class="w-4 h-4 rounded mr-2" style="background: ${school.colors.secondary}"></div>
                                <span class="font-mono">${school.colors.secondary}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            Ini adalah preview konfigurasi. Untuk melihat aplikasi sebenarnya, 
                            kunjungi URL di atas setelah deployment.
                        </p>
                    </div>
                </div>
            `, [
                {
                    text: 'Tutup',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function exportSchool(schoolId) {
            const school = schoolsData[schoolId];
            const exportData = {
                [schoolId]: school
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `school-${schoolId}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            logActivity(`Export sekolah: ${school.name}`);
            showNotification(`Config sekolah ${schoolId} berhasil diexport!`, 'success');
        }

        // User Management Functions
        function addNewUser() {
            showModal('Tambah User Baru', `
                <form id="addUserForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Username</label>
                        <input type="text" id="newUsername" placeholder="username" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Email</label>
                        <input type="email" id="newUserEmail" placeholder="user@email.com" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Password</label>
                        <input type="password" id="newPassword" placeholder="password" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Role</label>
                        <select id="newRole" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="teacher">Guru</option>
                            <option value="school_admin">Admin Sekolah</option>
                            <option value="super_admin">Super Admin</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Sekolah</label>
                        <select id="newUserSchool" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="all">Semua Sekolah</option>
                            ${Object.keys(schoolsData).map(schoolId => 
                                `<option value="${schoolId}">${schoolsData[schoolId].name}</option>`
                            ).join('')}
                        </select>
                    </div>
                </form>
            `, [
                {
                    text: 'Tambah User',
                    class: 'bg-green-600 hover:bg-green-700',
                    onclick: () => {
                        const form = document.getElementById('addUserForm');
                        if (form.checkValidity()) {
                            const username = document.getElementById('newUsername').value;
                            
                            if (usersData[username]) {
                                showNotification('Username sudah ada! Gunakan username yang berbeda.', 'error');
                                return;
                            }
                            
                            usersData[username] = {
                                username: username,
                                email: document.getElementById('newUserEmail').value,
                                role: document.getElementById('newRole').value,
                                school: document.getElementById('newUserSchool').value,
                                status: 'active',
                                last_login: null
                            };
                            
                            loadUsersList();
                            updateStats();
                            closeModal();
                            logActivity(`Menambah user baru: ${username}`);
                            showNotification(`User ${username} berhasil ditambahkan!`, 'success');
                        }
                    }
                },
                {
                    text: 'Batal',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function editUser(userId) {
            const user = usersData[userId];
            showModal(`Edit User: ${userId}`, `
                <form id="editUserForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Email</label>
                        <input type="email" id="editUserEmail" value="${user.email}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Role</label>
                        <select id="editRole" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="teacher" ${user.role === 'teacher' ? 'selected' : ''}>Guru</option>
                            <option value="school_admin" ${user.role === 'school_admin' ? 'selected' : ''}>Admin Sekolah</option>
                            <option value="super_admin" ${user.role === 'super_admin' ? 'selected' : ''}>Super Admin</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Sekolah</label>
                        <select id="editUserSchool" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="all" ${user.school === 'all' ? 'selected' : ''}>Semua Sekolah</option>
                            ${Object.keys(schoolsData).map(schoolId => 
                                `<option value="${schoolId}" ${user.school === schoolId ? 'selected' : ''}>${schoolsData[schoolId].name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">Status</label>
                        <select id="editUserStatus" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="active" ${user.status === 'active' ? 'selected' : ''}>Aktif</option>
                            <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Tidak Aktif</option>
                        </select>
                    </div>
                </form>
            `, [
                {
                    text: 'Simpan Perubahan',
                    class: 'bg-blue-600 hover:bg-blue-700',
                    onclick: () => {
                        usersData[userId] = {
                            ...user,
                            email: document.getElementById('editUserEmail').value,
                            role: document.getElementById('editRole').value,
                            school: document.getElementById('editUserSchool').value,
                            status: document.getElementById('editUserStatus').value
                        };
                        
                        loadUsersList();
                        closeModal();
                        logActivity(`Mengedit user: ${userId}`);
                        showNotification(`User ${userId} berhasil diupdate!`, 'success');
                    }
                },
                {
                    text: 'Batal',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function deleteUser(userId) {
            if (userId === 'admin') {
                showNotification('User admin tidak dapat dihapus!', 'error');
                return;
            }
            
            if (confirm(`Yakin ingin menghapus user "${userId}"?\n\nTindakan ini tidak dapat dibatalkan!`)) {
                delete usersData[userId];
                
                loadUsersList();
                updateStats();
                logActivity(`Menghapus user: ${userId}`);
                showNotification(`User ${userId} berhasil dihapus!`, 'success');
            }
        }

        // Utility Functions
        function filterSchools() {
            const searchTerm = document.getElementById('searchSchools')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            
            const cards = document.querySelectorAll('#schoolsList > div');
            
            cards.forEach(card => {
                const schoolName = card.querySelector('h4')?.textContent.toLowerCase() || '';
                const schoolStatus = card.querySelector('.inline-block')?.textContent.toLowerCase() || '';
                
                const matchesSearch = schoolName.includes(searchTerm);
                const matchesStatus = !statusFilter || schoolStatus.includes(statusFilter);
                
                if (matchesSearch && matchesStatus) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function refreshSchoolsList() {
            loadSchoolsList();
            updateStats();
            showNotification('Daftar sekolah berhasil direfresh!', 'success');
        }

        function importSchools() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            // Merge with existing data
                            schoolsData = { ...schoolsData, ...importedData };
                            
                            loadSchoolsList();
                            updateStats();
                            logActivity(`Import ${Object.keys(importedData).length} sekolah`);
                            showNotification(`${Object.keys(importedData).length} sekolah berhasil diimport!`, 'success');
                        } catch (error) {
                            showNotification('File JSON tidak valid!', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function exportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                schools: schoolsData,
                users: usersData,
                activity_log: activityLog
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `admin-panel-export-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            logActivity('Export semua data sistem');
            showNotification('Semua data berhasil diexport!', 'success');
        }

        function createBackup() {
            const backupType = document.getElementById('backupType')?.value || 'full';
            const backupName = `backup-${backupType}-${new Date().toISOString().slice(0, 10)}`;
            
            let backupData = {};
            
            switch (backupType) {
                case 'full':
                    backupData = {
                        timestamp: new Date().toISOString(),
                        type: 'full',
                        name: backupName,
                        schools: schoolsData,
                        users: usersData,
                        activity_log: activityLog,
                        backup_history: backupHistory
                    };
                    break;
                case 'schools':
                    backupData = {
                        timestamp: new Date().toISOString(),
                        type: 'schools',
                        name: backupName,
                        schools: schoolsData
                    };
                    break;
                case 'users':
                    backupData = {
                        timestamp: new Date().toISOString(),
                        type: 'users',
                        name: backupName,
                        users: usersData
                    };
                    break;
                case 'settings':
                    backupData = {
                        timestamp: new Date().toISOString(),
                        type: 'settings',
                        name: backupName,
                        settings: {
                            // Add settings data here
                        }
                    };
                    break;
            }
            
            // Save to backup history
            const backupRecord = {
                id: Date.now(),
                name: backupName,
                type: backupType,
                timestamp: new Date().toISOString(),
                size: JSON.stringify(backupData).length
            };
            
            backupHistory.push(backupRecord);
            
            // Download backup file
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${backupName}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            updateStats();
            loadBackupHistory();
            logActivity(`Membuat backup: ${backupName} (${backupType})`);
            showNotification(`Backup ${backupName} berhasil dibuat!`, 'success');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (confirm('Yakin ingin restore backup?\n\nData yang ada akan ditimpa!')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const backupData = JSON.parse(e.target.result);
                                
                                if (backupData.schools) {
                                    schoolsData = backupData.schools;
                                }
                                
                                if (backupData.users) {
                                    usersData = backupData.users;
                                }
                                
                                if (backupData.activity_log) {
                                    activityLog = backupData.activity_log;
                                }
                                
                                if (backupData.backup_history) {
                                    backupHistory = backupData.backup_history;
                                }
                                
                                loadSchoolsList();
                                loadUsersList();
                                updateStats();
                                loadRecentActivity();
                                loadBackupHistory();
                                
                                logActivity(`Restore backup: ${backupData.name || 'Unknown'}`);
                                showNotification('Backup berhasil direstore!', 'success');
                            } catch (error) {
                                showNotification('File backup tidak valid!', 'error');
                            }
                        };
                        reader.readAsText(file);
                    }
                }
            };
            input.click();
        }

        function downloadBackup(backupId) {
            const backup = backupHistory.find(b => b.id == backupId);
            if (backup) {
                showNotification(`Download backup: ${backup.name}`, 'info');
                // In a real implementation, you would download the actual backup file
            }
        }

        function deleteBackup(backupId) {
            if (confirm('Yakin ingin menghapus backup ini?')) {
                backupHistory = backupHistory.filter(b => b.id != backupId);
                loadBackupHistory();
                showNotification('Backup berhasil dihapus!', 'success');
            }
        }

        function syncData() {
            showNotification('Sinkronisasi data...', 'info');
            
            // Simulate sync process
            setTimeout(() => {
                updateConnectionStatus(true);
                showNotification('Data berhasil disinkronisasi!', 'success');
            }, 2000);
        }

        function updateConnectionStatus(isConnected) {
            const statusEl = document.getElementById('connectionStatus');
            if (statusEl) {
                if (isConnected) {
                    statusEl.className = 'w-3 h-3 rounded-full bg-green-500';
                    statusEl.title = 'Terhubung ke server';
                } else {
                    statusEl.className = 'w-3 h-3 rounded-full bg-red-500';
                    statusEl.title = 'Tidak terhubung ke server';
                }
            }
        }

        function logActivity(action) {
            activityLog.push({
                id: Date.now(),
                action: action,
                user: currentUser.username,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 100 activities
            if (activityLog.length > 100) {
                activityLog = activityLog.slice(-100);
            }
            
            loadRecentActivity();
        }

        function saveGeneralSettings(e) {
            e.preventDefault();
            
            const settings = {
                systemName: document.getElementById('systemName').value,
                mainDomain: document.getElementById('mainDomain').value,
                adminEmail: document.getElementById('adminEmail').value
            };
            
            logActivity('Menyimpan pengaturan umum');
            showNotification('Pengaturan umum berhasil disimpan!', 'success');
        }

        function saveSecuritySettings(e) {
            e.preventDefault();
            
            const settings = {
                sessionTimeout: document.getElementById('sessionTimeout').value,
                maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                enableTwoFactor: document.getElementById('enableTwoFactor').checked
            };
            
            logActivity('Menyimpan pengaturan keamanan');
            showNotification('Pengaturan keamanan berhasil disimpan!', 'success');
        }

        function showUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function showProfile() {
            showModal('Profil Admin', `
                <div class="text-center space-y-4">
                    <div class="w-20 h-20 gradient-bg rounded-full mx-auto flex items-center justify-center">
                        <i class="fas fa-user text-white text-2xl"></i>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-bold">${currentUser.username}</h3>
                        <p class="text-gray-600">Super Administrator</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <div class="font-semibold">Total Sekolah</div>
                            <div class="text-2xl font-bold text-blue-600">${Object.keys(schoolsData).length}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <div class="font-semibold">Total User</div>
                            <div class="text-2xl font-bold text-green-600">${Object.keys(usersData).length}</div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Anda memiliki akses penuh ke semua fitur admin panel.
                        </p>
                    </div>
                </div>
            `, [
                {
                    text: 'Tutup',
                    class: 'bg-gray-600 hover:bg-gray-700',
                    onclick: closeModal
                }
            ]);
        }

        function showSettings() {
            showSection('settings');
        }

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                showNotification('Logout berhasil!', 'success');
                // In a real implementation, redirect to login page
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        function loadTemplatesList() {
            // Placeholder for templates functionality
            showNotification('Fitur template sedang dalam pengembangan', 'info');
        }

        function loadReports() {
            // Placeholder for reports functionality
            showNotification('Fitur laporan sedang dalam pengembangan', 'info');
        }

        // Modal Functions
        function showModal(title, content, buttons = []) {
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b border-gray-200">
                        <h3 class="text-xl font-bold">${title}</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="p-6">
                        ${content}
                    </div>
                    
                    ${buttons.length > 0 ? `
                        <div class="flex justify-end space-x-3 p-6 border-t border-gray-200">
                            ${buttons.map(btn => `
                                <button onclick="${btn.onclick.toString().replace('function ', '').replace('() {', '').replace('}', '')}" 
                                        class="px-4 py-2 rounded-lg text-white transition-colors ${btn.class}">
                                    ${btn.text}
                                </button>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on outside click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        function closeModal() {
            const modal = document.querySelector('.modal-backdrop');
            if (modal) {
                modal.remove();
            }
        }

        // Notification Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            const icons = {
                success: 'check-circle',
                error: 'times-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.className = `notification ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${icons[type]}"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96dc1d7454789c7b',t:'MTc1NDk2MTI1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
